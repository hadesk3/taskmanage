<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <!-- Favicon -->
        <link rel="shortcut icon" href="/images/favicon.ico" />
        <link rel="stylesheet" href="/css/backend-plugin.min.css" />
        <link rel="stylesheet" href="/css/backend.css?v=1.0.0" />
        <link
            rel="stylesheet"
            href="/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css"
        />
        <link rel="stylesheet" href="/vendor/remixicon/fonts/remixicon.css" />

        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-calendar/dist/tui-calendar.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-date-picker/dist/tui-date-picker.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-time-picker/dist/tui-time-picker.css"
        />
        <style>
            .current-projects-wrapper {
                position: relative;
                overflow-x: auto;
                white-space: nowrap;
                scroll-behavior: smooth;
                width: 100%;
                padding: 10px;
                display: flex; /* Chỉnh các item nằm ngang */
            }

            /* Ẩn thanh cuộn */
            .current-projects-wrapper::-webkit-scrollbar {
                display: none;
            }
            .current-projects-wrapper {
                scrollbar-width: none;
            }

            /* Đảm bảo các dự án hiển thị ngang */
            .top-projects {
                display: flex; /* Bố cục theo hàng ngang */
                flex-wrap: nowrap; /* Không xuống dòng */
                gap: 15px; /* Khoảng cách giữa các dự án */
                padding: 0;
            }

            /* Định dạng từng dự án */
            .top-projects li {
                flex: 0 0 auto; /* Không co dãn, giữ nguyên kích thước */
                width: 300px; /* Điều chỉnh kích thước phù hợp */
            }
            /* Định dạng chung cho container chứa nút */

            /* Định dạng nút điều hướng */
            .scroll-btn {
                background-color: #007bff; /* Màu nền */
                color: white; /* Màu chữ */
                border: none;
                padding: 8px 12px;
                font-size: 18px;
                cursor: pointer;
                border-radius: 5px;
                transition: background 0.3s ease;
            }

            .scroll-btn:hover {
                background-color: #0056b3; /* Đổi màu khi hover */
            }
        </style>

        <script>
            function scrollProjects(direction) {
                const container = document.querySelector(
                    ".current-projects-wrapper"
                );
                const scrollAmount = 300; // Điều chỉnh khoảng cách trượt

                container.scrollBy({
                    left: direction * scrollAmount,
                    behavior: "smooth",
                });
            }
        </script>
    </head>

    <body class="  ">
        <!-- loader Start -->
        <div id="loading">
            <div id="loading-center"></div>
        </div>
        <!-- loader END -->
        <!-- Wrapper Start -->
        <div class="wrapper">
            <div class="content-page">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-8">
                            <div
                                class="card-transparent card-block card-stretch card-height"
                            >
                                <div class="card-body p-0">
                                    <div class="card">
                                        <div
                                            class="card-header d-flex justify-content-between"
                                        >
                                            <div class="header-title">
                                                <h4 class="card-title">
                                                    Overview Progress
                                                </h4>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-inline p-0 mb-0">
                                                <li class="mb-1">
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <p class="mb-0">
                                                                UX / UI Design
                                                            </p>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div
                                                                class="d-flex align-items-center justify-content-between"
                                                            >
                                                                <div
                                                                    class="iq-progress-bar bg-secondary-light"
                                                                >
                                                                    <span
                                                                        class="bg-secondary iq-progress progress-1"
                                                                        data-percent="65"
                                                                    ></span>
                                                                </div>
                                                                <span
                                                                    class="ml-3"
                                                                    >65%</span
                                                                >
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div
                                                                class="iq-media-group text-sm-right"
                                                            >
                                                                <a
                                                                    href="#"
                                                                    class="iq-media"
                                                                >
                                                                    <img
                                                                        class="img-fluid avatar-40 rounded-circle"
                                                                        src="/images/user/05.jpg"
                                                                        alt=""
                                                                    />
                                                                </a>
                                                                <a
                                                                    href="#"
                                                                    class="iq-media"
                                                                >
                                                                    <img
                                                                        class="img-fluid avatar-40 rounded-circle"
                                                                        src="/images/user/06.jpg"
                                                                        alt=""
                                                                    />
                                                                </a>
                                                                <a
                                                                    href="#"
                                                                    class="iq-media"
                                                                >
                                                                    <img
                                                                        class="img-fluid avatar-40 rounded-circle"
                                                                        src="/images/user/07.jpg"
                                                                        alt=""
                                                                    />
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4">
                            <div
                                class="card card-block card-stretch card-height"
                            >
                                <div class="card-body">
                                    <div
                                        class="card border-bottom pb-2 shadow-none"
                                    >
                                        <div
                                            class="card-body text-center inln-date flet-datepickr"
                                        >
                                            <input
                                                type="text"
                                                id="inline-date"
                                                class="date-input basicFlatpickr d-none"
                                                readonly="readonly"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="card-transparent mb-0">
                                <div
                                    class="card-header d-flex align-items-center justify-content-between p-0 pb-3"
                                >
                                    <div class="header-title">
                                        <h4 class="card-title">
                                            Current Projects
                                        </h4>
                                    </div>
                                </div>
                                <div
                                    class="card-header-toolbar d-flex align-items-center"
                                >
                                    <!-- Nút trượt trái -->
                                    <button
                                        class="scroll-btn left"
                                        onclick="scrollProjects(-1)"
                                    >
                                        &#10094;
                                    </button>
                                    <button
                                        class="scroll-btn right"
                                        onclick="scrollProjects(1)"
                                    >
                                        &#10095;
                                    </button>
                                    <!-- Bọc danh sách trong một div có thể cuộn ngang -->
                                    <div class="current-projects-wrapper">
                                        <ul
                                            class="list-unstyled row top-projects mb-0"
                                        >
                                            <li class="col-lg-4">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="mb-3">
                                                            Admin Panel
                                                            Customization
                                                        </h5>
                                                        <p class="mb-3">
                                                            <i
                                                                class="las la-calendar-check mr-2"
                                                            ></i
                                                            >02 / 02 / 2021
                                                        </p>
                                                        <div
                                                            class="iq-progress-bar bg-primary-light mb-4"
                                                        >
                                                            <span
                                                                class="bg-primary iq-progress progress-1"
                                                                data-percent="65"
                                                            ></span>
                                                        </div>
                                                        <div
                                                            class="d-flex align-items-center justify-content-between"
                                                        >
                                                            <div
                                                                class="iq-media-group"
                                                            >
                                                                <a
                                                                    href="#"
                                                                    class="iq-media"
                                                                >
                                                                    <img
                                                                        src="/images/user/02.jpg"
                                                                        class="img-fluid avatar-40 rounded-circle"
                                                                        alt=""
                                                                    />
                                                                </a>
                                                                <a
                                                                    href="#"
                                                                    class="iq-media"
                                                                >
                                                                    <img
                                                                        src="/images/user/03.jpg"
                                                                        class="img-fluid avatar-40 rounded-circle"
                                                                        alt=""
                                                                    />
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <!-- Các project khác sẽ được thêm vào đây -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Page end  -->
                </div>
            </div>
        </div>
        <!-- Wrapper End-->

        <!-- Modal list start -->

        <script>
            async function fetchProjects() {
                try {
                    const response = await fetch(
                        `${window.location.origin}/api/projects`
                    );
                    const data = await response.json();
                    if (data.code === 0) {
                        let projects = data.data.projectsWithCompletion;

                        projects.sort(
                            (a, b) =>
                                new Date(b.end_date) - new Date(a.end_date)
                        );

                        const latestProjects = projects.slice(0, 10);

                        renderProjectsToCurrentProject(latestProjects);
                    } else {
                        console.error("Lỗi khi lấy dữ liệu:", data.message);
                    }
                } catch (error) {
                    console.error("Lỗi kết nối API:", error);
                }
            }

            function renderProjectsToCurrentProject(projects) {
                const overviewContainer =
                    document.querySelector(".list-inline");
                const currentProjectsContainer =
                    document.querySelector(".top-projects");

                // Xóa dữ liệu cũ (nếu có)
                overviewContainer.innerHTML = "";
                currentProjectsContainer.innerHTML = "";

                // Hiển thị tối đa 8 project trong phần Overview Progress
                projects.slice(0, 8).forEach((project) => {
                    const lecturersHTML = project.lecturers
                        .map(
                            (lecturer) => `
            <a href="#" class="iq-media">
                <img class="img-fluid avatar-40 rounded-circle" src="${lecturer.avatar}" alt="${lecturer.name}" />
            </a>`
                        )
                        .join("");

                    const overviewHTML = `
            <li class="mb-1">
                <div class="row">
                    <div class="col-sm-3">
                        <p class="mb-0">${project.name}</p>
                    </div>
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="iq-progress-bar bg-secondary-light">
                                <span class="bg-secondary iq-progress" style="width: ${project.completion}%;"></span>
                            </div>
                            <span class="ml-3">${project.completion}%</span>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="iq-media-group text-sm-right">
                            ${lecturersHTML}
                        </div>
                    </div>
                </div>
            </li>`;
                    overviewContainer.innerHTML += overviewHTML;
                });

                // Hiển thị tối đa 6 project trong phần Current Projects
                projects.forEach((project) => {
                    const lecturersHTML = project.lecturers
                        .map(
                            (lecturer) => `
            <a href="#" class="iq-media">
                <img src="${lecturer.avatar}" class="img-fluid avatar-40 rounded-circle" alt="${lecturer.name}" />
            </a>`
                        )
                        .join("");

                    const currentProjectHTML = `
            <li class="col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="mb-3">${project.name}</h5>
                        <p class="mb-3"><i class="las la-calendar-check mr-2"></i>
                            ${new Date(
                                project.start_date
                            ).toLocaleDateString()} - ${new Date(
                        project.end_date
                    ).toLocaleDateString()}
                        </p>
                        <div class="iq-progress-bar bg-primary-light mb-4">
                            <span class="bg-primary iq-progress" style="width: ${
                                project.completion
                            }%;"></span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="iq-media-group">
                                ${lecturersHTML}
                            </div>
                        </div>
                    </div>
                </div>
            </li>`;
                    currentProjectsContainer.innerHTML += currentProjectHTML;
                });
            }

            document.addEventListener("DOMContentLoaded", fetchProjects);
        </script>
    </body>
</html>
