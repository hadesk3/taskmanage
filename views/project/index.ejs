<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Favicon -->
        <link rel="shortcut icon" href="/images/favicon.ico" />
        <link rel="stylesheet" href="/css/backend-plugin.min.css" />
        <link rel="stylesheet" href="/css/backend.css?v=1.0.0" />
        <link
            rel="stylesheet"
            href="/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css"
        />
        <link rel="stylesheet" href="/vendor/remixicon/fonts/remixicon.css" />

        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-calendar/dist/tui-calendar.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-date-picker/dist/tui-date-picker.css"
        />
        <link
            rel="stylesheet"
            href="/vendor/tui-calendar/tui-time-picker/dist/tui-time-picker.css"
        />
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body class="  ">
        <!-- loader Start -->
        <div id="loading">
            <div id="loading-center"></div>
        </div>
        <!-- loader END -->
        <!-- Wrapper Start -->
        <div class="wrapper">
            <div class="content-page">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <div
                                        class="d-flex flex-wrap align-items-center justify-content-between breadcrumb-content"
                                    >
                                        <h5>Your Projects</h5>
                                        <div
                                            class="d-flex flex-wrap align-items-center justify-content-between"
                                        >
                                            <div
                                                class="dropdown status-dropdown mr-3"
                                            >
                                                <div
                                                    class="dropdown-toggle"
                                                    id="dropdownMenuButton03"
                                                    data-toggle="dropdown"
                                                >
                                                    <div class="btn bg-body">
                                                        <span class="h6"
                                                            >Status :</span
                                                        >
                                                        In Progress<i
                                                            class="ri-arrow-down-s-line ml-2 mr-0"
                                                        ></i>
                                                    </div>
                                                </div>
                                                <div
                                                    class="dropdown-menu dropdown-menu-right"
                                                    aria-labelledby="dropdownMenuButton03"
                                                >
                                                    <a
                                                        class="dropdown-item"
                                                        href="#"
                                                        ><i
                                                            class="ri-mic-line mr-2"
                                                        ></i
                                                        >In Progress</a
                                                    >
                                                    <a
                                                        class="dropdown-item"
                                                        href="#"
                                                        ><i
                                                            class="ri-attachment-line mr-2"
                                                        ></i
                                                        >Priority</a
                                                    >
                                                    <a
                                                        class="dropdown-item"
                                                        href="#"
                                                        ><i
                                                            class="ri-file-copy-line mr-2"
                                                        ></i
                                                        >Category</a
                                                    >
                                                </div>
                                            </div>
                                            <div
                                                class="list-grid-toggle d-flex align-items-center mr-3"
                                            >
                                                <div
                                                    data-toggle-extra="tab"
                                                    data-target-extra="#grid"
                                                    class="active"
                                                >
                                                    <div class="grid-icon mr-3">
                                                        <svg
                                                            width="20"
                                                            height="20"
                                                            xmlns="http://www.w3.org/2000/svg"
                                                            viewBox="0 0 24 24"
                                                            fill="none"
                                                            stroke="currentColor"
                                                            stroke-width="2"
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                        >
                                                            <rect
                                                                x="3"
                                                                y="3"
                                                                width="7"
                                                                height="7"
                                                            ></rect>
                                                            <rect
                                                                x="14"
                                                                y="3"
                                                                width="7"
                                                                height="7"
                                                            ></rect>
                                                            <rect
                                                                x="14"
                                                                y="14"
                                                                width="7"
                                                                height="7"
                                                            ></rect>
                                                            <rect
                                                                x="3"
                                                                y="14"
                                                                width="7"
                                                                height="7"
                                                            ></rect>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div
                                                    data-toggle-extra="tab"
                                                    data-target-extra="#list"
                                                >
                                                    <div class="grid-icon">
                                                        <svg
                                                            width="20"
                                                            height="20"
                                                            xmlns="http://www.w3.org/2000/svg"
                                                            viewBox="0 0 24 24"
                                                            fill="none"
                                                            stroke="currentColor"
                                                            stroke-width="2"
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                        >
                                                            <line
                                                                x1="21"
                                                                y1="10"
                                                                x2="3"
                                                                y2="10"
                                                            ></line>
                                                            <line
                                                                x1="21"
                                                                y1="6"
                                                                x2="3"
                                                                y2="6"
                                                            ></line>
                                                            <line
                                                                x1="21"
                                                                y1="14"
                                                                x2="3"
                                                                y2="14"
                                                            ></line>
                                                            <line
                                                                x1="21"
                                                                y1="18"
                                                                x2="3"
                                                                y2="18"
                                                            ></line>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                class="pl-3 border-left btn-new"
                                            >
                                                <a
                                                    href="#"
                                                    class="btn btn-primary"
                                                    data-target="#new-project-modal"
                                                    data-toggle="modal"
                                                    >New Project</a
                                                >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        id="grid"
                        class="item-content animate__animated animate__fadeIn active"
                        data-toggle-extra="tab-content"
                    >
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm-8">
                                                <div
                                                    class="d-flex align-items-center"
                                                >
                                                    <div
                                                        id="circle-progress-24"
                                                        class="circle-progress-01 circle-progress circle-progress-success"
                                                        data-min-value="0"
                                                        data-max-value="100"
                                                        data-value="40"
                                                        data-type="percent"
                                                    ></div>
                                                    <div class="ml-3">
                                                        <h5 class="mb-1">
                                                            Blog/Magazine Theme
                                                        </h5>
                                                        <p class="mb-0">
                                                            Launch visually
                                                            appealing Blog
                                                            theme.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                class="col-sm-4 text-sm-right mt-3 mt-sm-0"
                                            >
                                                <div class="iq-media-group">
                                                    <a
                                                        href="#"
                                                        class="iq-media"
                                                    >
                                                        <img
                                                            class="img-fluid avatar-40 rounded-circle"
                                                            src="/images/user/05.jpg"
                                                            alt=""
                                                        />
                                                    </a>
                                                    <a
                                                        href="#"
                                                        class="iq-media"
                                                    >
                                                        <img
                                                            class="img-fluid avatar-40 rounded-circle"
                                                            src="/images/user/06.jpg"
                                                            alt=""
                                                        />
                                                    </a>
                                                    <a
                                                        href="#"
                                                        class="iq-media"
                                                    >
                                                        <img
                                                            class="img-fluid avatar-40 rounded-circle"
                                                            src="/images/user/07.jpg"
                                                            alt=""
                                                        />
                                                    </a>
                                                </div>
                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                 



                    <!-- Page end  -->
                </div>
            </div>
        </div>
        
        <!-- Wrapper End-->

        <!-- Modal list start -->
        <div
            class="modal fade"
            role="dialog"
            aria-modal="true"
            id="new-project-modal"
        >
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div
                        class="modal-header d-block text-center pb-3 border-bttom"
                    >
                        <h3 class="modal-title" id="exampleModalCenterTitle01">
                            New Project
                        </h3>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="exampleInputText01" class="h5"
                                        >Project Name*</label
                                    >
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="exampleInputText01"
                                        placeholder="Project Name"
                                    />
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="exampleInputText02" class="h5"
                                        >Description</label
                                    >
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="exampleInputText02"
                                        placeholder="Description"
                                    />
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="form-group mb-3">
                                    <label for="exampleInputText2" class="h5"
                                        >Categories *</label
                                    >
                                    <select
                                        name="type"
                                        class="selectpicker form-control"
                                        data-style="py-0"
                                    >
                                        <option>Category</option>
                                        <option>Android</option>
                                        <option>IOS</option>
                                        <option>Ui/Ux Design</option>
                                        <option>Development</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="form-group mb-3">
                                    <label for="exampleInputText004" class="h5"
                                        >Due Dates*</label
                                    >
                                    <input
                                        type="date"
                                        class="form-control"
                                        id="exampleInputText004"
                                        value=""
                                    />
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="form-group mb-3">
                                    <label for="assignMembersDropdown" class="h5">Assign Members*</label>
                                    <select class="form-control" id="assignMembersDropdown" multiple>
                                        <!-- Options will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            
                            
                            <div class="col-lg-12">
                                <div
                                    class="d-flex flex-wrap align-items-ceter justify-content-center mt-2"
                                >
                                    <div
                                        class="btn btn-primary mr-3"
                                        onclick = "saveProject()"
                                        data-dismiss="modal"
                                    >
                                        Save
                                    </div>
                                    <div
                                        class="btn btn-primary"
                                        data-dismiss="modal"
                                    >
                                        Cancel
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      
    </body>

    <script>
   function saveProject() {
    const projectName = document.getElementById('exampleInputText01').value;
    const description = document.getElementById('exampleInputText02').value;

    const projectType = document.querySelector('select[name="type"]').value;
    const dueDate = document.getElementById('exampleInputText004').value;
    const assignMembersDropdown = document.getElementById('assignMembersDropdown');
    const assignMembers = Array.from(assignMembersDropdown.selectedOptions).map(option => option.value);
    const projectData = {
        name: projectName,
        type: projectType,
        end_date: dueDate,
        description: description
    };

    console.log('Sending Project Data:', projectData);

    fetch('http://localhost:3000/api/projects', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(projectData)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Parsed response:', data); 
        // Check if the response status is 201
        if (data.status === 201) {
            alert('Project created successfully!');
            
            const projectId = data.newProject._id; 
            console.log(projectId)
            assignMembers.forEach(userId => 
            { createProjectUser(projectId, userId); 

            });
        } else {
            // Handle failure, even if no message is returned
            const errorMessage = data.message || 'Unknown error';
            alert('Failed to create project: ' + errorMessage);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while creating the project.');
    });}


    function createProjectUser(projectId, userId) { const projectUserData = { project_id: projectId, user_id: userId }; fetch('http://localhost:3000/api/projectUsers', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(projectUserData) }) .then(response => response.json()) .then(data => { console.log('Project User created:', data); }) .catch(error => { console.error('Error creating project user:', error); }); }

</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetchUsers();
    });

    function fetchUsers() {
        fetch('http://localhost:3000/api/users')
            .then(response => response.json())
            .then(data => {
                const users = data.data;  // Truy cập vào key 'data' chứa mảng người dùng
                const assignMembersDropdown = document.getElementById('assignMembersDropdown');
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user._id;
                    option.text = user.name;
                    assignMembersDropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching users:', error);
            });
    }
</script>
<script>
    // Fetch dữ liệu dự án từ API
    async function fetchProjects() {
        const response = await fetch('http://localhost:3000/api/getProjects');
        const projects = await response.json();
        const grid = document.getElementById('grid');
        console.log(projects);
        grid.innerHTML = projects.map(project => `
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-8">
                                <div class="d-flex align-items-center">
                                    <div
                                        class="circle-progress-01"
                                        data-min-value="0"
                                        data-max-value="100"
                                        data-value="${project.progress.toFixed(2)}"
                                        data-type="percent"
                                    >
                                        <div class="progress-value">${project.progress.toFixed(2)}%</div>
                                    </div>
                                    <div class="ml-3">
                                        <h5 class="mb-1">${project.name}</h5>
                                        <p class="mb-0">Description: ${project.description || 'Không có mô tả'}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4 text-sm-right mt-3 mt-sm-0">
                                <p>Start: ${new Date(project.start_date).toLocaleDateString()}</p>
                                <p>End: ${new Date(project.end_date).toLocaleDateString()}</p>
                                <p>Status: ${project.status}</p>
                                
                                <!-- Thành viên -->
                                <div class="members">
                                    <strong>Members:</strong>
                                    <ul>
                                        ${project.users.map(user => `<li>${user}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');

        // Cập nhật màu sắc vòng tròn tiến trình
        document.querySelectorAll('.circle-progress-01').forEach(el => {
            const value = parseFloat(el.getAttribute('data-value'));
            if (value >= 75) {
                el.style.backgroundColor = '#4caf50';  // Màu xanh lá cây
            } else if (value >= 50) {
                el.style.backgroundColor = '#ffc107';  // Màu vàng
            } else if (value >= 25) {
                el.style.backgroundColor = '#ff9800';  // Màu cam
            } else {
                el.style.backgroundColor = '#f44336';  // Màu đỏ
            }
        });
    }

    fetchProjects();  // Gọi hàm fetch khi tải trang
</script>



</html>
